<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Clientes</title>
    <style>
        body {
            background-color: #0d1117;
            color: #c9d1d9;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 80%;
            margin: auto;
            padding: 20px;
        }
        .section {
            margin-bottom: 20px;
            padding: 20px;
            background-color: #161b22;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        .section h2 {
            margin-top: 0;
            color: #58a6ff;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        table, th, td {
            border: 1px solid #30363d;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #21262d;
        }
        input, select {
            padding: 10px;
            margin: 10px 0;
            width: calc(100% - 22px);
            background-color: #0d1117;
            color: #c9d1d9;
            border: 1px solid #30363d;
            border-radius: 5px;
        }
        .add-client-form button, .modal button {
            background-color: #238636;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
        }
        .add-client-form button:hover, .modal button:hover {
            background-color: #2ea043;
        }
        .edit-btn {
            background-color: #4caf50;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
        }
        .edit-btn:hover {
            background-color: #45a049;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
        }
        .modal-content {
            background-color: #161b22;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 50%;
            border-radius: 8px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover, .close:focus {
            color: white;
            text-decoration: none;
            cursor: pointer;
        }
        .total-sales span, .monthly-sales span {
            font-size: 1.5em;
            color: #58a6ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="section add-client-form">
            <h2>Adicionar Novo Cliente</h2>
            <form id="addClientForm">
                <label for="clientName">Nome:</label>
                <input type="text" id="clientName" required>
                <label for="clientProfile">Perfil:</label>
                <select id="clientProfile">
                    <option value="bravo">Bravo</option>
                    <option value="safe">Safe</option>
                    <option value="medio">Médio</option>
                </select>
                <label for="clientDissonance">Linguagem de Dissonância:</label>
                <select id="clientDissonance">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                </select>
                <label for="clientLocation">Localização:</label>
                <input type="text" id="clientLocation" required>
                <label for="clientPurchase">Última Compra:</label>
                <input type="text" id="clientPurchase" placeholder="Produto">
                <label for="purchaseDate">Data:</label>
                <input type="date" id="purchaseDate">
                <label for="purchaseValue">Valor:</label>
                <input type="number" id="purchaseValue" step="0.01">
                <button type="button" onclick="addClient()">Adicionar Cliente</button>
            </form>
        </div>

        <div class="section client-table">
            <h2>Lista de Clientes</h2>
            <table id="clientsTable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Perfil</th>
                        <th>Dissonância</th>
                        <th>Localização</th>
                        <th>Última Compra</th>
                        <th>Data</th>
                        <th>Valor</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Clientes serão adicionados aqui -->
                </tbody>
            </table>
        </div>

        <div class="section total-sales">
            <h2>Valor Total Vendido</h2>
            <span id="totalSales">R$ 0.00</span>
        </div>

        <div class="section monthly-sales">
            <h2>Valor Total Vendido por Mês</h2>
            <table id="monthlySalesTable">
                <thead>
                    <tr>
                        <th>Mês</th>
                        <th>Valor Total Vendido</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Totais mensais serão adicionados aqui -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal para edição -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Editar Cliente</h2>
            <form id="editClientForm">
                <label for="editClientName">Nome:</label>
                <input type="text" id="editClientName" required>
                <label for="editClientProfile">Perfil:</label>
                <select id="editClientProfile">
                    <option value="bravo">Bravo</option>
                    <option value="safe">Safe</option>
                    <option value="medio">Médio</option>
                </select>
                <label for="editClientDissonance">Linguagem de Dissonância:</label>
                <select id="editClientDissonance">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                </select>
                <label for="editClientLocation">Localização:</label>
                <input type="text" id="editClientLocation" required>
                <label for="editClientPurchase">Última Compra:</label>
                <input type="text" id="editClientPurchase" placeholder="Produto">
                <label for="editPurchaseDate">Data:</label>
                <input type="date" id="editPurchaseDate">
                <label for="editPurchaseValue">Valor:</label>
                <input type="number" id="editPurchaseValue" step="0.01">
                <button type="button" onclick="updateClient()">Salvar Alterações</button>
            </form>
        </div>
    </div>

    <script>
        let totalSales = 0;
        let editRowIndex = null;

        document.addEventListener('DOMContentLoaded', (event) => {
            loadClientsFromStorage();
        });

        function addClient() {
            const clientName = document.getElementById('clientName').value;
            const clientProfile = document.getElementById('clientProfile').value;
            const clientDissonance = document.getElementById('clientDissonance').value;
            const clientLocation = document.getElementById('clientLocation').value;
            const clientPurchase = document.getElementById('clientPurchase').value;
            const purchaseDate = document.getElementById('purchaseDate').value;
            const purchaseValue = parseFloat(document.getElementById('purchaseValue').value);

            const clientData = {
                name: clientName,
                profile: clientProfile,
                dissonance: clientDissonance,
                location: clientLocation,
                purchase: clientPurchase,
                date: purchaseDate,
                value: purchaseValue
            };

            addClientToTable(clientData);
            saveClientToStorage(clientData);

            totalSales += purchaseValue;
            document.getElementById('totalSales').textContent = R$ ${totalSales.toFixed(2)};

            document.getElementById('addClientForm').reset();

            updateMonthlySales();
        }

        function addClientToTable(clientData) {
            const table = document.getElementById('clientsTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();

            newRow.insertCell(0).textContent = clientData.name;
            newRow.insertCell(1).textContent = clientData.profile;
            newRow.insertCell(2).textContent = clientData.dissonance;
            newRow.insertCell(3).textContent = clientData.location;
            newRow.insertCell(4).textContent = clientData.purchase;
            newRow.insertCell(5).textContent = clientData.date;
            newRow.insertCell(6).textContent = clientData.value.toFixed(2);

            const actionsCell = newRow.insertCell(7);
            const editButton = document.createElement('button');
            editButton.textContent = 'Editar';
            editButton.classList.add('edit-btn');
            editButton.onclick = () => {
                openModal(clientData, newRow.rowIndex);
            };
            actionsCell.appendChild(editButton);
        }

        function saveClientToStorage(clientData) {
            let clients = JSON.parse(localStorage.getItem('clients')) || [];
            clients.push(clientData);
            localStorage.setItem('clients', JSON.stringify(clients));
        }

        function loadClientsFromStorage() {
            let clients = JSON.parse(localStorage.getItem('clients')) || [];
            clients.forEach(client => {
                addClientToTable(client);
                totalSales += client.value;
            });
            document.getElementById('totalSales').textContent = R$ ${totalSales.toFixed(2)};

            updateMonthlySales();
        }

        function openModal(clientData, rowIndex) {
            editRowIndex = rowIndex;

            document.getElementById('editClientName').value = clientData.name;
            document.getElementById('editClientProfile').value = clientData.profile;
            document.getElementById('editClientDissonance').value = clientData.dissonance;
            document.getElementById('editClientLocation').value = clientData.location;
            document.getElementById('editClientPurchase').value = clientData.purchase;
            document.getElementById('editPurchaseDate').value = clientData.date;
            document.getElementById('editPurchaseValue').value = clientData.value;

            document.getElementById('editModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function updateClient() {
            const clientName = document.getElementById('editClientName').value;
            const clientProfile = document.getElementById('editClientProfile').value;
            const clientDissonance = document.getElementById('editClientDissonance').value;
            const clientLocation = document.getElementById('editClientLocation').value;
            const clientPurchase = document.getElementById('editClientPurchase').value;
            const purchaseDate = document.getElementById('editPurchaseDate').value;
            const purchaseValue = parseFloat(document.getElementById('editPurchaseValue').value);

            const table = document.getElementById('clientsTable').getElementsByTagName('tbody')[0];
            const row = table.rows[editRowIndex - 1];

            totalSales -= parseFloat(row.cells[6].textContent);
            totalSales += purchaseValue;

            row.cells[0].textContent = clientName;
            row.cells[1].textContent = clientProfile;
            row.cells[2].textContent = clientDissonance;
            row.cells[3].textContent = clientLocation;
            row.cells[4].textContent = clientPurchase;
            row.cells[5].textContent = purchaseDate;
            row.cells[6].textContent = purchaseValue.toFixed(2);

            document.getElementById('totalSales').textContent = R$ ${totalSales.toFixed(2)};

            const clientData = {
                name: clientName,
                profile: clientProfile,
                dissonance: clientDissonance,
                location: clientLocation,
                purchase: clientPurchase,
                date: purchaseDate,
                value: purchaseValue
            };

            updateClientInStorage(editRowIndex - 1, clientData);

            updateMonthlySales();

            closeModal();
        }

        function updateClientInStorage(index, clientData) {
            let clients = JSON.parse(localStorage.getItem('clients')) || [];
            clients[index] = clientData;
            localStorage.setItem('clients', JSON.stringify(clients));
        }

        function updateMonthlySales() {
            const clients = JSON.parse(localStorage.getItem('clients')) || [];
            const monthlyTotals = {};

            clients.forEach(client => {
                const date = new Date(client.date);
                const month = date.getMonth() + 1;  // JavaScript months are 0-based.
                const year = date.getFullYear();
                const monthYear = ${month}-${year};

                if (!monthlyTotals[monthYear]) {
                    monthlyTotals[monthYear] = 0;
                }

                monthlyTotals[monthYear] += client.value;
            });

            const table = document.getElementById('monthlySalesTable').getElementsByTagName('tbody')[0];
            table.innerHTML = '';  // Clear the table before adding updated totals.

            Object.keys(monthlyTotals).forEach(monthYear => {
                const newRow = table.insertRow();
                newRow.insertCell(0).textContent = monthYear;
                newRow.insertCell(1).textContent = R$ ${monthlyTotals[monthYear].toFixed(2)};
            });
        }
    </script>
</body>
</html>
